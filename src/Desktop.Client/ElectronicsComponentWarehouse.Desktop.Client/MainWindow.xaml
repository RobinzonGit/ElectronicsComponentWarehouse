<Window x:Class="ElectronicsComponentWarehouse.Desktop.Client.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:local="clr-namespace:ElectronicsComponentWarehouse.Desktop.Client.Common.Converters"
        mc:Ignorable="d"
        Title="Electronics Component Warehouse" 
        Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        MinHeight="600" MinWidth="900">

    <Window.Resources>
        <local:StockStatusToBrushConverter x:Key="StockStatusToBrushConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header / App Bar -->
        <Border Grid.Row="0" Background="{DynamicResource PrimaryHueMidBrush}" 
                Height="60" Padding="16,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- App Logo and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="Chip" Width="32" Height="32" 
                                            Foreground="White" Margin="0,0,12,0"/>
                    <TextBlock Text="Electronics Component Warehouse" 
                             FontSize="20" FontWeight="SemiBold" Foreground="White"
                             VerticalAlignment="Center"/>
                </StackPanel>

                <!-- User Info -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="Account" Width="24" Height="24" 
                                            Foreground="White" Margin="0,0,8,0"/>
                    <TextBlock x:Name="UserInfoText" Text="Not logged in" 
                             Foreground="White" VerticalAlignment="Center"/>
                    <Button x:Name="LoginButton" Content="Login" Margin="16,0,0,0"
                           Style="{StaticResource MaterialDesignFlatButton}"
                           Foreground="White" BorderBrush="White"
                           Click="LoginButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Categories Tree -->
            <Border Grid.Column="0" BorderBrush="{DynamicResource MaterialDesignDivider}" 
                   BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" 
                               Margin="16,16,16,8">
                        <TextBlock Text="Categories" FontSize="16" 
                                 FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <Button x:Name="RefreshCategoriesButton" 
                               Style="{StaticResource MaterialDesignIconButton}"
                               ToolTip="Refresh categories"
                               Margin="8,0,0,0" Click="RefreshCategoriesButton_Click">
                            <materialDesign:PackIcon Kind="Refresh" Width="20" Height="20"/>
                        </Button>
                        <Button x:Name="AddCategoryButton" 
                               Style="{StaticResource MaterialDesignIconButton}"
                               ToolTip="Add category (Admin only)"
                               Margin="8,0,0,0" Click="AddCategoryButton_Click">
                            <materialDesign:PackIcon Kind="Plus" Width="20" Height="20"/>
                        </Button>
                    </StackPanel>

                    <TreeView x:Name="CategoriesTreeView" Grid.Row="1" 
                             Margin="8" BorderThickness="0"
                             SelectedItemChanged="CategoriesTreeView_SelectedItemChanged">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding ChildCategories}">
                                <StackPanel Orientation="Horizontal" Margin="4">
                                    <materialDesign:PackIcon Kind="Folder" 
                                                           Width="16" Height="16" 
                                                           Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding DisplayName}" 
                                             FontWeight="SemiBold"/>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                </Grid>
            </Border>

            <!-- Vertical Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch"
                         Background="Transparent" Cursor="SizeWE"/>

            <!-- Right Panel - Components -->
            <Border Grid.Column="2" Padding="16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Toolbar -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                        <Button x:Name="AddComponentButton" Content="Add Component"
                               Style="{StaticResource MaterialDesignRaisedButton}"
                               Margin="0,0,8,0" Click="AddComponentButton_Click">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Plus" 
                                                               Width="16" Height="16" 
                                                               Margin="0,0,4,0"/>
                                        <TextBlock Text="Add Component"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>

                        <Button x:Name="EditComponentButton" Content="Edit"
                               Style="{StaticResource MaterialDesignOutlinedButton}"
                               Margin="0,0,8,0" Click="EditComponentButton_Click">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Pencil" 
                                                               Width="16" Height="16" 
                                                               Margin="0,0,4,0"/>
                                        <TextBlock Text="Edit"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>

                        <Button x:Name="DeleteComponentButton" Content="Delete"
                               Style="{StaticResource MaterialDesignOutlinedButton}"
                               Margin="0,0,8,0" Click="DeleteComponentButton_Click">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Delete" 
                                                               Width="16" Height="16" 
                                                               Margin="0,0,4,0"/>
                                        <TextBlock Text="Delete"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>

                        <Button x:Name="RefreshComponentsButton" Content="Refresh"
                               Style="{StaticResource MaterialDesignOutlinedButton}"
                               Margin="16,0,8,0" Click="RefreshComponentsButton_Click">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Refresh" 
                                                               Width="16" Height="16" 
                                                               Margin="0,0,4,0"/>
                                        <TextBlock Text="Refresh"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>

                        <Button x:Name="ExportButton" Content="Export"
                               Style="{StaticResource MaterialDesignOutlinedButton}"
                               Margin="0,0,8,0" Click="ExportButton_Click">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Export" 
                                                               Width="16" Height="16" 
                                                               Margin="0,0,4,0"/>
                                        <TextBlock Text="Export"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>
                    </StackPanel>

                    <!-- Search Box -->
                    <Grid Grid.Row="1" Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox x:Name="SearchTextBox" Grid.Column="0" 
                                materialDesign:HintAssist.Hint="Search components..."
                                Padding="12,8" FontSize="14"
                                TextChanged="SearchTextBox_TextChanged"/>

                        <Button x:Name="ClearSearchButton" Grid.Column="1" 
                               Style="{StaticResource MaterialDesignIconButton}"
                               Margin="8,0,0,0" Click="ClearSearchButton_Click">
                            <materialDesign:PackIcon Kind="Close" Width="20" Height="20"/>
                        </Button>
                    </Grid>

                    <!-- Components DataGrid -->
                    <DataGrid x:Name="ComponentsDataGrid" Grid.Row="2" 
                             AutoGenerateColumns="False"
                             CanUserAddRows="False"
                             CanUserDeleteRows="False"
                             SelectionMode="Single"
                             SelectionUnit="FullRow"
                             IsReadOnly="True"
                             MouseDoubleClick="ComponentsDataGrid_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding Id}" 
                                              Width="50"/>
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" 
                                              Width="200"/>
                            <DataGridTextColumn Header="Manufacturer" 
                                              Binding="{Binding Manufacturer}" 
                                              Width="120"/>
                            <DataGridTextColumn Header="Model" 
                                              Binding="{Binding ModelNumber}" 
                                              Width="120"/>
                            <DataGridTextColumn Header="Quantity" 
                                              Binding="{Binding StockQuantity}" 
                                              Width="80"/>
                            <DataGridTextColumn Header="Min Stock" 
                                              Binding="{Binding MinimumStockLevel}" 
                                              Width="80"/>
                            <DataGridTemplateColumn Header="Status" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="4" Padding="4,2" 
                                                Background="{Binding StockStatus, Converter={StaticResource StockStatusToBrushConverter}}">
                                            <TextBlock Text="{Binding StockStatus}" 
                                                     HorizontalAlignment="Center"
                                                     Foreground="White"
                                                     FontWeight="SemiBold"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Location" 
                                              Binding="{Binding StorageCellNumber}" 
                                              Width="100"/>
                            <DataGridTextColumn Header="Price" 
                                              Binding="{Binding FormattedUnitPrice}" 
                                              Width="80"/>
                            <DataGridTextColumn Header="Total Value" 
                                              Binding="{Binding FormattedTotalValue}" 
                                              Width="100"/>
                            <DataGridTextColumn Header="Last Updated" 
                                              Binding="{Binding LastUpdated, Converter={StaticResource DateTimeConverter}}" 
                                              Width="140"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Status Bar -->
                    <StatusBar Grid.Row="3" Margin="0,8,0,0">
                        <StatusBarItem>
                            <TextBlock x:Name="StatusText" Text="Ready"/>
                        </StatusBarItem>
                        <Separator/>
                        <StatusBarItem>
                            <TextBlock x:Name="ComponentsCountText" Text="0 components"/>
                        </StatusBarItem>
                        <Separator/>
                        <StatusBarItem>
                            <TextBlock x:Name="CategoryInfoText" Text="No category selected"/>
                        </StatusBarItem>
                        <Separator/>
                        <StatusBarItem HorizontalAlignment="Right">
                            <ProgressBar x:Name="LoadingProgressBar" 
                                       Width="100" Height="16" 
                                       IsIndeterminate="False" 
                                       Visibility="Collapsed"/>
                        </StatusBarItem>
                    </StatusBar>
                </Grid>
            </Border>
        </Grid>

        <!-- Footer -->
        <Border Grid.Row="2" Background="{DynamicResource MaterialDesignBackground}" 
               BorderBrush="{DynamicResource MaterialDesignDivider}" 
               BorderThickness="0,1,0,0">
            <StatusBar>
                <StatusBarItem>
                    <TextBlock Text="Electronics Component Warehouse v1.0"/>
                </StatusBarItem>
                <Separator/>
                <StatusBarItem>
                    <TextBlock x:Name="ConnectionStatusText" Text="Disconnected"/>
                </StatusBarItem>
                <Separator/>
                <StatusBarItem HorizontalAlignment="Right">
                    <TextBlock x:Name="CurrentTimeText" Text="--:--:--"/>
                </StatusBarItem>
            </StatusBar>
        </Border>
    </Grid>
</Window>