# Настройка Postman для тестирования API

## Шаги настройки:

1. **Импорт коллекции:**
   - Откройте Postman
   - Нажмите "Import"
   - Выберите файл `postman-collection.json` из папки `docs`

2. **Настройка переменных окружения:**
   - Создайте новое окружение (Environment)
   - Добавьте переменные:
     - `base_url`: `http://localhost:5000`
     - `admin_token`: (оставьте пустым, заполнится после авторизации)
     - `user_token`: (оставьте пустым, заполнится после авторизации)

3. **Запуск API:**
   ```bash
   cd src/Web.API
   dotnet run
Последовательность тестирования:

Шаг 1: Регистрация пользователей

Запустите "Регистрация администратора"

Запустите "Регистрация пользователя"

Шаг 2: Авторизация

Запустите "Вход администратора"

Скопируйте токен из ответа в переменную admin_token

Повторите для пользователя (создайте соответствующий запрос)

Шаг 3: Тестирование категорий

Запустите "Получение всех категорий"

Запустите "Создание категории"

Шаг 4: Тестирование компонентов

Запустите "Получение всех компонентов"

Запустите "Создание компонента"

Альтернативный способ - использование скриптов:
Вы также можете использовать готовые скрипты для тестирования:

bash
# Запуск полного теста
./scripts/api-tests/full-test.sh

# Или отдельные тесты:
./scripts/api-tests/test-auth.sh
./scripts/api-tests/test-categories.sh
./scripts/api-tests/test-components.sh
Проверка базы данных:
bash
# Применение миграций
./scripts/database/apply-migrations.sh

# Проверка таблиц
sqlcmd -S "(localdb)\mssqllocaldb" -d "ElectronicsComponentWarehouseDB_Dev" -Q "SELECT * FROM Categories;"
Проблемы и решения:
Ошибка подключения к базе данных:

Убедитесь, что SQL Server LocalDB установлен

Проверьте строку подключения в appsettings.Development.json

Ошибка "Port already in use":

Измените порт в launchSettings.json

Или убейте процесс: kill $(lsof -t -i:5000)

Ошибки миграций:

Удалите базу данных: ./scripts/database/drop-database.sh

Пересоздайте миграции: dotnet ef migrations remove && dotnet ef migrations add InitialCreate

### **Шаг 4.9: Финальная проверка и запуск**

```bash
# Возвращаемся в корень проекта
cd ../..

# Проверяем структуру проекта
echo "Проверяем структуру проекта..."
find . -name "*.csproj" | sort

# Восстанавливаем зависимости
echo "Восстанавливаем зависимости..."
dotnet restore

# Собираем проект
echo "Собираем проект..."
dotnet build --configuration Debug

# Применяем миграции
echo "Применяем миграции базы данных..."
cd src/Web.API
dotnet ef database update --verbose

# Запускаем API
echo "Запускаем API сервер..."
echo "API будет доступен по адресу: https://localhost:5001"
echo "Swagger UI: https://localhost:5001/swagger"
echo ""
echo "Для остановки сервера нажмите Ctrl+C"
echo ""

dotnet run
# После остановки сервера, фиксируем изменения
git add .

git commit -m "Этап 4: Миграции базы данных и тестирование API

- Созданы и применены миграции Entity Framework Core
- Настроены скрипты для работы с базой данных
- Добавлены тестовые скрипты для API (регистрация, аутентификация, компоненты, категории)
- Создана Postman коллекция для тестирования
- Настроена документация для тестирования API
- Реализованы скрипты автоматического тестирования
- Проверена работоспособность всех слоев приложения
- Убедились, что база данных создается корректно с начальными данными
- Протестированы основные сценарии использования API"